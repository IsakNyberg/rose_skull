<!DOCTYPE html>
<html lang="">
  <head>
  <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
  <meta content="utf-8" http-equiv="encoding">

<script src="jspack.js"></script>
<script type="text/javascript">
main = function() {
  var name = prompt("Name:", "");
  const socket = new WebSocket('ws://85.229.19.61:63834/ws/' + name);
  socket.onopen = function() {
    console.log("socket opened :)");
  };

  socket.onerror = function(e) {
    console.log('websocket error! code: ' + e.code + ' reason: ' + e.reason);
  };

  socket.onclose = function(e) {
    console.log('websocket closed! code: ' + e.code + ' reason: ' + e.reason);
    //clear("Connection Closed!");
  };
  socket.onmessage = function(e) {
    //console.log("recieved:\n" + e.data);
    if (e.data[0] == "1") {
      display_game(e.data);
    } else if (e.data[0] == "2") {
      show_message(e.data);
    } else {
      console.log("Could not parse message.");
    }
  };

  function show_message(msg) {
    //document.getElementById("message").innerHTML = "";  // delete buttons
    msg = msg.substring(1);
    document.getElementById('message').innerHTML = msg;
  };

  function display_game(data) {
    var struct = new JSPack();
    data = data.substring(1);
    const encoder = new TextEncoder()
    const bytes = encoder.encode(data)

    var start = 0;
    var end = 5;
    var game_info_bytes = bytes.slice(start, end);
    var unpack1 = struct.Unpack('BBBBB', game_info_bytes, 0);

    var ongoing = unpack1[0];
    var current_player_index = unpack1[1];
    var current_bet = unpack1[2];
    var num_players = unpack1[3];
    var num_flipped = unpack1[4];

    for (let i = 0; i < num_players; i++){
      start = end
      end += 8
      draw_player(bytes.slice(start, end));
    }
    start = end;
    end += num_flipped;
    draw_flipped(bytes.slice(start, end));

    if (num_players == current_player_index){
      var own_turn = true;
    } else {
      var own_turn = false;
    }
    draw_own_player(own_turn, bytes.slice(end));

  };

  function draw_player(bytes) {
    var struct = new JSPack();
    var unpack = struct.Unpack('4sBBBB', bytes);
    var name = unpack[0];
    var score = unpack[1];
    var has_passed = unpack[2];
    var hand_len = unpack[3];
    var board_len = unpack[4];
  };

  function draw_flipped(bytes) {
    var struct = new JSPack();
    var unpack = struct.Unpack('B'.repeat(bytes.length), bytes);
  };

  function draw_own_player(own_turn, bytes) {
    var struct = new JSPack();
    var unpack = struct.Unpack('4sBBBB', bytes.slice(0, 8));
    var name = unpack[0];
    var score = unpack[1];
    var has_passed = unpack[2];
    var hand_len = unpack[3];
    var board_len = unpack[4];
    var hand = struct.Unpack('B'.repeat(hand_len), bytes.slice(8, 8+hand_len));
    var board = struct.Unpack('B'.repeat(board_len), bytes.slice(8+hand_len));
  };
}
window.onload = main;
</script>


    <style>
      /* text centered over image */
      .everything{
        width: 100%;
        height: 100%;
      }
      .left{
        position: relative;
        float: right;
        right: 55%;
      }
      .right{
        margin-top: 50px;
        position: relative;
        float: left;
        left: 55%;
      }
      .hand{
        width: 275px;
      }
      .hand_text{
        font-family: "Lucida Console", "Courier New", monospace;
        font-size: 20px; 
        position: relative;
        color: white;
      }
      .board{
      }
      .board_text{
        font-family: "Lucida Console", "Courier New", monospace;
        font-size: 30px; 
        text-align: left;
        color: white;
      }
      .player_list{
      }
      .player {
      }
      .card_row {
        width: 275px;
        float: left;
        display: block; 
        border-spacing: 5px;
      }
      .card_stack {
        width: 60px;
        height: 75px;
        float: left;
        display: block; 
        border-spacing: 5px;
      }
      .card_div{
        width:50px;
        height:75px;
        display: table-cell;
        margin-top: 0px;
        margin-bottom: 5px;
        margin-right: 5px;
        margin-left: 0px;
        z-index: 2;
      }
      .card_text {
        font-family: "Lucida Console", "Courier New", monospace;
        font-size: 50px; 
        position: relative;
        color: white;
        top: -50%;
        left: 24%;
      }
      .player_text {
        font-family: "Lucida Console", "Courier New", monospace;
        font-size: 50px; 
        position: relative;
        color: white;
        top: -50%;
        left: 30%;
      }
      .rose {
        width:50px;
        height:75px;
      }
      .skull {
        width:50px;
        height:75px;
      }
      .back {
        width:50px;
        height:75px;
        margin-left: 0px;
      }
    </style>
    <title>Rose and Skull</title>
  </head>
  <body height="100%" style="background-color:#a0a0a0;">
    <div class="everything">
      <div class="left">
        <div class="player_list" id="player_list">
          <div class="player">
            <div class="player_text">Isak</div>
            <div class="card_row">
              <div class="card_div">
                <img src="back.jpeg" alt="Back" class="back">
              </div>
              <div class="card_div">
                <img src="back.jpeg" alt="Back" class="back">
              </div>
              <div class="card_div">
                <img src="back.jpeg" alt="Back" class="back">
              </div>
              <div class="card_div">
                <img src="back.jpeg" alt="Back" class="back">
              </div>
            </div> 
            <div class="card_stack">
              <div class="card_div">
                <img src="back.jpeg" alt="Back" class="back">
                <div class="card_text">1</div>
              </div>
            </div>
          </div> 
          <div class="player">
            <div class="player_text">Greg</div>
            <div class="card_row">
              <div class="card_div">
                <img src="back.jpeg" alt="Back" class="back">
              </div>
              <div class="card_div">
                <img src="back.jpeg" alt="Back" class="back">
              </div>
              <div class="card_div">
                <img src="back.jpeg" alt="Back" class="back">
              </div>
              <div class="card_div">
                <img src="back.jpeg" alt="Back" class="back">
              </div>
            </div> 
            <div class="card_stack">
              <div class="card_div">
                <img src="back.jpeg" alt="Back" class="back">
                <div class="card_text">2</div>
              </div>
            </div>
          </div> 
          <div class="player">
            <div class="player_text">Jack</div>
            <div class="card_row">
              <div class="card_div">
                <img src="back.jpeg" alt="Back" class="back">
              </div>
              <div class="card_div">
                <img src="back.jpeg" alt="Back" class="back">
              </div>
              <div class="card_div">
                <img src="back.jpeg" alt="Back" class="back">
              </div>
              <div class="card_div">
                <img src="back.jpeg" alt="Back" class="back">
              </div>
            </div> 
            <div class="card_stack">
              <div class="card_div">
                <img src="back.jpeg" alt="Back" class="back">
                <div class="card_text">2</div>
              </div>
            </div>
          </div> 
          <div class="player">
            <div class="player_text">Grog</div>
            <div class="card_row">
              <div class="card_div">
                <img src="back.jpeg" alt="Back" class="back">
              </div>
              <div class="card_div">
                <img src="back.jpeg" alt="Back" class="back">
              </div>
              <div class="card_div">
                <img src="back.jpeg" alt="Back" class="back">
              </div>
              <div class="card_div">
                <img src="back.jpeg" alt="Back" class="back">
              </div>
            </div> 
            <div class="card_stack">
              <div class="card_div">
                <img src="back.jpeg" alt="Back" class="back">
                <div class="card_text">2</div>
              </div>
            </div>
          </div> 
        </div>
      </div>
      <div class="right"> 
        <div class="board">
          <div class="board_text">
            Game is ongoing
          </div>
          <div class="board_text" id="message">
            Cannot place that card
          </div>
          <div class="board_text">
            Current bet: 0
          </div>
          <div class="card_row">
            <div class="card_div">
                <img src="rose.jpeg" alt="rose" class="rose">
              </div>
              <div class="card_div">
                <img src="rose.jpeg" alt="rose" class="rose">
              </div>
              <div class="card_div">
                <img src="skull.jpeg" alt="skull" class="skull">
              </div>
          </div>
        </div>
        <div class="hand">
          <div class="player_text">
            Isak
          </div>
          <div class="hand_text">
            Placed:
          </div>
          <div class="card_row">
            <div class="card_div">
                <img src="rose.jpeg" alt="rose" class="rose">
              </div>
              <div class="card_div">
                <img src="rose.jpeg" alt="rose" class="rose">
              </div>
          </div>
          <div class="hand_text">
            Hand:
          </div>
          <div class="card_row">
            <div class="card_div">
              <img src="rose.jpeg" alt="rose" class="rose">
            </div>
            <div class="card_div">
              <img src="skull.jpeg" alt="skull" class="skull">
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
